<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GKI Kernel Versions</title>
  <script>
    (function () {
      // GoatCounter analytics: replace with your GoatCounter site code.
      var GOATCOUNTER_SITE = 'my-gki';
      var isGithubPages = /\.github\.io$/i.test(location.hostname);
      if (!isGithubPages || !GOATCOUNTER_SITE || GOATCOUNTER_SITE.indexOf('REPLACE_WITH_') === 0) {
        return;
      }
      var endpoint = 'https://' + GOATCOUNTER_SITE + '.goatcounter.com/count';
      var script = document.createElement('script');
      script.async = true;
      script.src = endpoint + '.js';
      script.setAttribute('data-goatcounter', endpoint);
      document.head.appendChild(script);
    })();
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500;700&family=Roboto+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <div class="header-left">
        <h1 id="headerTitle">GKI Kernel Versions</h1>
        <p id="headerSubtitle">Android Generic Kernel Image &mdash; version tracking dashboard</p>
      </div>
      <div class="header-actions">
        <button class="theme-toggle" id="themeToggle" title="Toggle theme">
          <span id="themeIcon">&#9789;</span>
          <span id="themeLabel">Light</span>
        </button>
        <a class="github-link" href="https://github.com/zzh20188/GKI_KernelSU_SUSFS" target="_blank" rel="noopener">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
          GitHub
        </a>
      </div>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="tabs-container">
    <div class="tabs" id="tabs"></div>
  </nav>

  <!-- Announcement Modal -->
  <div class="modal-overlay announce-overlay" id="announceModal" style="display:none;">
    <div class="modal-card announce-card">
      <div class="modal-header">
        <span class="modal-title" id="announceModalTitle">Announcement</span>
        <button class="modal-close" id="announceModalClose">&times;</button>
      </div>
      <div class="modal-body announce-body" id="announceModalBody"></div>
      <div class="announce-actions">
        <button class="announce-btn announce-btn-dismiss" id="announceDismissToday"></button>
        <button class="announce-btn announce-btn-close" id="announceClose"></button>
      </div>
    </div>
  </div>

  <!-- Time Converter -->
  <section class="tools-section">
    <details class="tools-inner" id="tcDetails">
      <summary class="tools-summary" id="tcTitle">Time Converter</summary>
      <div class="tc-row">
        <div class="tc-inputs">
          <div class="tc-field">
            <label class="tc-label" id="tcDateLabel">Date</label>
            <input type="date" class="tc-input" id="tcDate">
          </div>
          <div class="tc-field">
            <label class="tc-label" id="tcTimeLabel">Time</label>
            <input type="time" class="tc-input" id="tcTime" step="1">
          </div>
        </div>
        <div class="tc-result-box">
          <span class="tc-result" id="tcResult">â€”</span>
          <button class="modal-copy tc-copy" id="tcCopy">Copy</button>
        </div>
      </div>
    </details>
  </section>

  <!-- Main -->
  <main class="main" id="content">
    <div class="loading">
      <div class="loading-spinner"></div>
      <p id="loadingText" style="margin-top: 1rem;">Loading kernel data&hellip;</p>
    </div>
  </main>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Footer -->
  <footer class="footer">
    <span id="footerPre">Data sourced from</span>
    <a href="https://android.googlesource.com/kernel/common" target="_blank" rel="noopener">android.googlesource.com</a><span id="footerPost">. Updated automatically via GitHub Actions.</span>
  </footer>

  <!-- Detail Modal -->
  <div class="modal-overlay" id="modal" style="display:none;">
    <div class="modal-card">
      <div class="modal-header">
        <span class="modal-title" id="modalTitle">GitHub Action Parameters</span>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

<script>
(function () {
  'use strict';

  // ---- i18n ----
  const I18N = {
    en: {
      title: 'GKI Kernel Versions',
      subtitle: 'Android Generic Kernel Image \u2014 version tracking dashboard',
      light: 'Light',
      dark: 'Dark',
      loading: 'Loading kernel data\u2026',
      errorTitle: 'Failed to load kernel data.',
      errorHint: 'Make sure <code>web/data/</code> contains the JSON files.',
      releases: 'Releases',
      first: 'First',
      latest: 'Latest',
      latestKernel: 'Latest Kernel',
      date: 'Security Patch',
      kernelVersion: 'Kernel Version',
      footerPre: 'Data sourced from',
      footerPost: '. Updated automatically via GitHub Actions.',
      announce: 'Announcement',
      announceClose: 'Close',
      announceDismiss: 'Don\u2019t show today',
      modalTitle: 'GitHub Action Parameters',
      modalAndroid: 'Android Version',
      modalKernel: 'Kernel Version',
      modalSublevel: 'Sublevel',
      modalPatch: 'Security Patch Level',
      copy: 'Copy',
      copied: 'Copied',
      tcTitle: 'Time Converter',
      tcDate: 'Date',
      tcTime: 'Time (UTC)',
      tcToast: 'Copied to clipboard',
    },
    zh: {
      title: 'GKI \u5185\u6838\u7248\u672c',
      subtitle: 'Android \u901a\u7528\u5185\u6838\u955c\u50cf \u2014 \u7248\u672c\u8ddf\u8e2a\u770b\u677f',
      light: '\u6d45\u8272',
      dark: '\u6df1\u8272',
      loading: '\u6b63\u5728\u52a0\u8f7d\u5185\u6838\u6570\u636e\u2026',
      errorTitle: '\u52a0\u8f7d\u5185\u6838\u6570\u636e\u5931\u8d25\u3002',
      errorHint: '\u8bf7\u786e\u4fdd <code>web/data/</code> \u5305\u542b JSON \u6587\u4ef6\u3002',
      releases: '\u53d1\u5e03\u6570',
      first: '\u8d77\u59cb',
      latest: '\u6700\u65b0',
      latestKernel: '\u6700\u65b0\u5185\u6838',
      date: '\u5b89\u5168\u8865\u4e01\u65e5\u671f',
      kernelVersion: '\u5185\u6838\u7248\u672c',
      footerPre: '\u6570\u636e\u6765\u6e90\u4e8e',
      footerPost: '\u3002\u901a\u8fc7 GitHub Actions \u81ea\u52a8\u66f4\u65b0\u3002',
      announce: '\u516c\u544a',
      announceClose: '\u5173\u95ed',
      announceDismiss: '\u4eca\u65e5\u4e0d\u518d\u663e\u793a',
      modalTitle: 'GitHub Action \u53c2\u6570',
      modalAndroid: 'Android \u7248\u672c',
      modalKernel: '\u5185\u6838\u7248\u672c',
      modalSublevel: '\u5b50\u7248\u672c\u53f7',
      modalPatch: '\u5b89\u5168\u8865\u4e01\u7ea7\u522b',
      copy: '\u590d\u5236',
      copied: '\u5df2\u590d\u5236',
      tcTitle: '\u65f6\u95f4\u8f6c\u6362',
      tcDate: '\u65e5\u671f',
      tcTime: '\u65f6\u95f4 (UTC)',
      tcToast: '\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f',
    },
  };

  const lang = /^zh\b/i.test(navigator.language) ? 'zh' : 'en';
  const t = I18N[lang];
  document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';

  const DATA_FILES = [
    { android: 'android12', kernel: '5.10', label: 'android12 / 5.10' },
    { android: 'android13', kernel: '5.15', label: 'android13 / 5.15' },
    { android: 'android14', kernel: '6.1',  label: 'android14 / 6.1' },
    { android: 'android15', kernel: '6.6',  label: 'android15 / 6.6' },
  ];
  const RUNTIME_CACHE_KEY = Date.now().toString(36);

  function withCacheKey(url) {
    return url + (url.indexOf('?') === -1 ? '?' : '&') + 'v=' + encodeURIComponent(RUNTIME_CACHE_KEY);
  }

  async function fetchJsonFresh(url) {
    const r = await fetch(withCacheKey(url), { cache: 'no-store' });
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    return r.json();
  }

  // ---- Apply i18n to static elements ----
  document.getElementById('headerTitle').textContent = t.title;
  document.getElementById('headerSubtitle').textContent = t.subtitle;
  document.getElementById('loadingText').textContent = t.loading;
  document.getElementById('footerPre').textContent = t.footerPre;
  document.getElementById('footerPost').textContent = t.footerPost;
  document.getElementById('tcTitle').textContent = t.tcTitle;
  document.getElementById('tcDateLabel').textContent = t.tcDate;
  document.getElementById('tcTimeLabel').textContent = t.tcTime;
  document.getElementById('tcCopy').textContent = t.copy;
  document.title = t.title;

  // ---- Theme ----
  const themeToggle = document.getElementById('themeToggle');
  const themeIcon = document.getElementById('themeIcon');
  const themeLabel = document.getElementById('themeLabel');

  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    if (theme === 'dark') {
      themeIcon.textContent = '\u263D';
      themeLabel.textContent = t.light;
    } else {
      themeIcon.textContent = '\u2600';
      themeLabel.textContent = t.dark;
    }
  }

  const savedTheme = localStorage.getItem('theme') || 'dark';
  setTheme(savedTheme);

  themeToggle.addEventListener('click', function () {
    const current = document.documentElement.getAttribute('data-theme');
    setTheme(current === 'dark' ? 'light' : 'dark');
  });

  // ---- Data loading ----
  async function loadData() {
    const results = await Promise.allSettled(
      DATA_FILES.map(f =>
        fetchJsonFresh(`data/${f.android}/${f.kernel}.json`)
      )
    );

    const datasets = [];
    for (let i = 0; i < results.length; i++) {
      if (results[i].status === 'fulfilled') {
        datasets.push({ meta: DATA_FILES[i], data: results[i].value });
      }
    }

    if (datasets.length === 0) {
      document.getElementById('content').innerHTML =
        `<div class="error"><p>${t.errorTitle}</p><p style="margin-top:0.5rem;color:var(--text-muted)">${t.errorHint}</p></div>`;
      return;
    }

    renderTabs(datasets);
    renderPanels(datasets);

    // Activate first tab
    const firstTab = document.querySelector('.tab');
    if (firstTab) firstTab.click();
  }

  // ---- Render tabs ----
  function renderTabs(datasets) {
    const tabsEl = document.getElementById('tabs');
    tabsEl.innerHTML = '';
    datasets.forEach((ds, idx) => {
      const btn = document.createElement('button');
      btn.className = 'tab';
      btn.textContent = ds.meta.label;
      btn.dataset.panel = `panel-${idx}`;
      btn.addEventListener('click', () => activateTab(btn));
      tabsEl.appendChild(btn);
    });
  }

  function activateTab(btn) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    btn.classList.add('active');
    const panel = document.getElementById(btn.dataset.panel);
    if (panel) panel.classList.add('active');
  }

  // ---- Render panels ----
  function renderPanels(datasets) {
    const content = document.getElementById('content');
    content.innerHTML = '';

    datasets.forEach((ds, idx) => {
      const panel = document.createElement('div');
      panel.className = 'tab-panel';
      panel.id = `panel-${idx}`;
      panel.innerHTML = buildCard(ds.data, ds.meta);
      content.appendChild(panel);
    });
  }

  function buildCard(data, meta) {
    const entries = data.entries || [];
    const lts = data.lts;
    const totalReleases = entries.length;
    const firstDate = entries.length > 0 ? entries[0].date : 'N/A';
    const lastDate = entries.length > 0 ? entries[entries.length - 1].date : 'N/A';
    const lastKernel = entries.length > 0 ? entries[entries.length - 1].kernel : 'N/A';

    let ltsHtml = '';
    if (lts) {
      const ltsSublevel = lts.split('.')[2] || '';
      ltsHtml = `
        <div class="lts-box lts-clickable" data-android="${esc(meta.android)}" data-kernel="${esc(meta.kernel)}" data-sublevel="${esc(ltsSublevel)}" data-patch="lts">
          <span class="lts-label">LTS</span>
          <span class="lts-version">${esc(lts)}</span>
        </div>`;
    }

    // Two-column table, ascending order (oldest to newest)
    const mid = Math.ceil(entries.length / 2);
    const leftCol = entries.slice(0, mid);
    const rightCol = entries.slice(mid);

    function buildHalf(col) {
      let rows = '';
      col.forEach(entry => {
        const sublevel = entry.kernel.split('.')[2] || '';
        rows += `<tr class="row-clickable" data-android="${esc(meta.android)}" data-kernel="${esc(meta.kernel)}" data-sublevel="${esc(sublevel)}" data-patch="${esc(entry.date)}">
          <td class="date-cell">${esc(entry.date)}</td>
          <td class="kernel-version">${esc(entry.kernel)}</td>
        </tr>`;
      });
      return `<table>
        <thead class="table-half-head"><tr><th>${t.date}</th><th>${t.kernelVersion}</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>`;
    }

    return `
      <div class="card">
        <div class="card-header">
          <span class="badge badge-android">${esc(meta.android)}</span>
          <span class="badge badge-kernel">Kernel ${esc(meta.kernel)}</span>
        </div>
        ${ltsHtml}
        <div class="stats">
          <div class="stat">
            <div class="stat-label">${t.releases}</div>
            <div class="stat-value">${totalReleases}</div>
          </div>
          <div class="stat">
            <div class="stat-label">${t.first}</div>
            <div class="stat-value">${esc(firstDate)}</div>
          </div>
          <div class="stat">
            <div class="stat-label">${t.latest}</div>
            <div class="stat-value">${esc(lastDate)}</div>
          </div>
          <div class="stat">
            <div class="stat-label">${t.latestKernel}</div>
            <div class="stat-value">${esc(lastKernel)}</div>
          </div>
        </div>
        <div class="table-dual-wrapper">
          <div class="table-dual-header">
            <span>${t.date}</span>
            <span>${t.kernelVersion}</span>
          </div>
          <div class="table-dual-body">
            <div class="table-half">${buildHalf(leftCol)}</div>
            <div class="table-half">${buildHalf(rightCol)}</div>
          </div>
        </div>
      </div>`;
  }

  function esc(str) {
    const el = document.createElement('span');
    el.textContent = str;
    return el.innerHTML;
  }

  function renderInlineMarkdown(text) {
    let html = esc(text == null ? '' : String(text));
    const codeTokens = [];

    html = html.replace(/`([^`\n]+)`/g, function (_, codeText) {
      codeTokens.push('<code>' + codeText + '</code>');
      return '\u0000CODE' + (codeTokens.length - 1) + '\u0000';
    });

    html = html.replace(/\[([^\]\n]+)\]\((https?:\/\/[^\s)]+)\)/gi, function (_, label, url) {
      return '<a href="' + url + '" target="_blank" rel="noopener noreferrer">' + label + '</a>';
    });
    html = html.replace(/\*\*([^*\n]+)\*\*/g, '<strong>$1</strong>');
    html = html.replace(/\*([^*\n]+)\*/g, '<em>$1</em>');

    return html.replace(/\u0000CODE(\d+)\u0000/g, function (_, idx) {
      return codeTokens[Number(idx)] || '';
    });
  }

  function renderMarkdown(markdownText) {
    const normalized = String(markdownText == null ? '' : markdownText)
      .replace(/\r\n?/g, '\n')
      .trim();
    if (!normalized) return '';

    const blocks = normalized.split(/\n{2,}/);
    const out = [];

    blocks.forEach(function (block) {
      const lines = block.split('\n');
      const fence = block.match(/^```([a-zA-Z0-9_-]+)?\n([\s\S]*?)\n```$/);
      if (fence) {
        const langClass = fence[1] ? ' class="lang-' + fence[1].toLowerCase() + '"' : '';
        out.push('<pre><code' + langClass + '>' + esc(fence[2]) + '</code></pre>');
        return;
      }

      const heading = block.match(/^\s*(#{1,6})\s+(.+)$/);
      if (heading && lines.length === 1) {
        const level = heading[1].length;
        out.push('<h' + level + '>' + renderInlineMarkdown(heading[2]) + '</h' + level + '>');
        return;
      }

      if (lines.every(function (line) { return /^\s*[-*]\s+/.test(line); })) {
        out.push('<ul>' + lines.map(function (line) {
          return '<li>' + renderInlineMarkdown(line.replace(/^\s*[-*]\s+/, '')) + '</li>';
        }).join('') + '</ul>');
        return;
      }

      if (lines.every(function (line) { return /^\s*\d+\.\s+/.test(line); })) {
        out.push('<ol>' + lines.map(function (line) {
          return '<li>' + renderInlineMarkdown(line.replace(/^\s*\d+\.\s+/, '')) + '</li>';
        }).join('') + '</ol>');
        return;
      }

      if (lines.every(function (line) { return /^\s*>\s?/.test(line); })) {
        out.push('<blockquote>' + lines.map(function (line) {
          return renderInlineMarkdown(line.replace(/^\s*>\s?/, ''));
        }).join('<br>') + '</blockquote>');
        return;
      }

      out.push('<p>' + lines.map(renderInlineMarkdown).join('<br>') + '</p>');
    });

    return out.join('');
  }

  function normalizeAnnouncementText(value) {
    if (Array.isArray(value)) return value.join('\n');
    if (value == null) return '';
    return String(value);
  }

  function getAnnouncementText(item) {
    if (lang === 'zh') {
      return normalizeAnnouncementText(item.content_zh_md || item.content_zh || item.content_md || item.content);
    }
    return normalizeAnnouncementText(item.content_md || item.content || item.content_zh_md || item.content_zh);
  }

  // ---- Modal ----
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modalTitle');
  const modalBody = document.getElementById('modalBody');
  const modalClose = document.getElementById('modalClose');

  function modalRow(label, value) {
    return `
      <div class="modal-row">
        <span class="modal-label">${label}</span>
        <span class="modal-value-group">
          <span class="modal-value">${esc(value)}</span>
          <button class="modal-copy" data-copy="${esc(value)}">${t.copy}</button>
        </span>
      </div>`;
  }

  function showModal(android, kernel, sublevel, patch) {
    modalTitle.textContent = t.modalTitle;
    modalBody.innerHTML =
      modalRow(t.modalAndroid, android) +
      modalRow(t.modalKernel, kernel) +
      modalRow(t.modalSublevel, sublevel) +
      modalRow(t.modalPatch, patch);
    modal.style.display = '';
  }

  function hideModal() {
    modal.style.display = 'none';
  }

  modalClose.addEventListener('click', hideModal);
  modal.addEventListener('click', function (e) {
    if (e.target === modal) hideModal();
  });
  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape') { hideModal(); hideAnnounce(); }
  });

  // ---- Toast ----
  const toastEl = document.getElementById('toast');
  let toastTimer;
  function showToast(msg) {
    clearTimeout(toastTimer);
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    toastTimer = setTimeout(function () {
      toastEl.classList.remove('show');
    }, 1800);
  }

  // Copy button handler (modal + time converter)
  function copyText(text) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      return navigator.clipboard.writeText(text);
    }
    // Fallback for non-secure contexts (HTTP)
    var ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.opacity = '0';
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    return Promise.resolve();
  }

  document.addEventListener('click', function (e) {
    const btn = e.target.closest('.modal-copy');
    if (!btn) return;
    const text = btn.dataset.copy;
    if (!text) return;
    copyText(text).then(function () {
      btn.textContent = t.copied;
      btn.classList.add('copied');
      showToast(t.tcToast);
      setTimeout(function () {
        btn.textContent = t.copy;
        btn.classList.remove('copied');
      }, 1500);
    }).catch(function () {});
  });

  // Row click
  document.addEventListener('click', function (e) {
    // LTS box
    const ltsBox = e.target.closest('.lts-clickable');
    if (ltsBox) {
      showModal(
        ltsBox.dataset.android,
        ltsBox.dataset.kernel,
        ltsBox.dataset.sublevel,
        ltsBox.dataset.patch
      );
      return;
    }
    // Table row
    const row = e.target.closest('.row-clickable');
    if (!row) return;
    showModal(row.dataset.android, row.dataset.kernel, row.dataset.sublevel, row.dataset.patch);
  });

  // ---- Announcement Modal ----
  const announceModal = document.getElementById('announceModal');
  const announceModalTitle = document.getElementById('announceModalTitle');
  const announceModalBody = document.getElementById('announceModalBody');
  const announceModalClose = document.getElementById('announceModalClose');
  const announceDismissToday = document.getElementById('announceDismissToday');
  const announceCloseBtn = document.getElementById('announceClose');

  function localDateStr() {
    var d = new Date();
    return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
  }

  function hideAnnounce() {
    announceModal.style.display = 'none';
  }

  function dismissAnnounceToday() {
    localStorage.setItem('announce_dismiss', localDateStr());
    hideAnnounce();
  }

  announceModalClose.addEventListener('click', hideAnnounce);
  announceCloseBtn.addEventListener('click', hideAnnounce);
  announceDismissToday.addEventListener('click', dismissAnnounceToday);
  announceModal.addEventListener('click', function (e) {
    if (e.target === announceModal) hideAnnounce();
  });

  async function loadAnnouncement() {
    try {
      const json = await fetchJsonFresh('data/announcement.json');
      const items = json.items;
      if (!items || items.length === 0) return;

      // Check "don't show today"
      if (localStorage.getItem('announce_dismiss') === localDateStr()) return;

      announceModalTitle.textContent = t.announce;
      announceDismissToday.textContent = t.announceDismiss;
      announceCloseBtn.textContent = t.announceClose;

      let html = '';
      items.forEach(function (item) {
        const text = getAnnouncementText(item);
        const markdownHtml = renderMarkdown(text);
        if (!markdownHtml) return;

        const dateText = item.date ? esc(item.date) : '';
        html += '<article class="announce-item">' +
          '<div class="announce-text">' + markdownHtml + '</div>' +
          (dateText ? '<div class="announce-meta"><time class="announce-date" datetime="' + dateText + '">' + dateText + '</time></div>' : '') +
          '</article>';
      });
      if (!html) return;
      announceModalBody.innerHTML = html;
      announceModal.style.display = '';
    } catch (e) {
      // silently ignore
    }
  }

  // ---- Time Converter ----
  const tcDate = document.getElementById('tcDate');
  const tcTime = document.getElementById('tcTime');
  const tcResult = document.getElementById('tcResult');
  const tcCopy = document.getElementById('tcCopy');

  // Default to now in UTC
  (function initTC() {
    const now = new Date();
    tcDate.value = now.toISOString().slice(0, 10);
    tcTime.value = now.toISOString().slice(11, 19);
    updateTC();
  })();

  function updateTC() {
    const d = tcDate.value;
    const tm = tcTime.value;
    if (!d || !tm) { tcResult.textContent = '\u2014'; tcCopy.dataset.copy = ''; return; }
    // Parse as UTC directly
    const parts = tm.split(':');
    const h = parseInt(parts[0], 10);
    const m = parseInt(parts[1], 10);
    const s = parseInt(parts[2] || '0', 10);
    const dp = d.split('-');
    const local = new Date(Date.UTC(parseInt(dp[0]), parseInt(dp[1]) - 1, parseInt(dp[2]), h, m, s));
    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const pad = n => String(n).padStart(2, '0');
    const utcStr = `${days[local.getUTCDay()]} ${months[local.getUTCMonth()]} ${pad(local.getUTCDate())} ${pad(local.getUTCHours())}:${pad(local.getUTCMinutes())}:${pad(local.getUTCSeconds())} UTC ${local.getUTCFullYear()}`;
    tcResult.textContent = utcStr;
    tcCopy.dataset.copy = utcStr;
  }

  tcDate.addEventListener('input', updateTC);
  tcTime.addEventListener('input', updateTC);

  // ---- Init ----
  loadAnnouncement();
  loadData();
})();
</script>

</body>
</html>
